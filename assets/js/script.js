// EASY QUESTIONS
let easyQuestions = [
    {   
        id: 1,
        question: "What is the capital of France?",
        correctAnswer: "Paris",
        wrongAnswers: ["Italy", "Cannes", "Marseille"]
	},
    {   
        id: 2,
        question: "Which Queen of Pop was married to Guy Ritchie and Sean Penn?",
        correctAnswer: "Madonna",
        wrongAnswers: ["Celine Dion", "Mariah Carey", "Cher"]
	},
    {   
        id: 3,
        question: "What brand is also known as the Golden Arches?",
        correctAnswer: "McDonalds",
        wrongAnswers: ["KFC", "Kenny Rogers", "Subway"]
	},
    {   
        id: 4,
        question: "Often described as the longest river on earth, on which continent would you find the Nile?",
        correctAnswer: "Africa",
        wrongAnswers: ["Asia", "Europe", "North America"]
	},
    {   
        id: 5,
        question: "What elements make up water?",
        correctAnswer: "oxygen and hydrogen",
        wrongAnswers: ["oxygen and nitrogen", "oxygen and carbon", "oxygen and sodium"]
	},
    {   
        id: 6,
        question: "Which scientist came up with the theory of E=MC2?",
        correctAnswer: "Albert Einstein",
        wrongAnswers: ["Isaac Newton", "Marie Curie", "Stephen Hawking"]
	},
    {   
        id: 7,
        question: "What animal is Pumbaa in the Lion King?",
        correctAnswer: "warthog",
        wrongAnswers: ["tiger", "meerkat", "mandrill"]
	},
    {
        id: 8,
        question: "How many cards are there in a pack of cards (excluding jokers)?",
        correctAnswer: "52",
        wrongAnswers: ["32", "60", "50"]
	},
    {
        id: 9,
        question: "What bird is famous for being pink?",
        correctAnswer: "Flamingo",
        wrongAnswers: ["turaco", "southern cassowary", "bar-throated minla"]
	},
    {   
        id: 10,
        question: "What planet is closest to the sun? ",
        correctAnswer: "Mercury",
        wrongAnswers: ["Saturn", "Venus", "Pluto"]
	},
];

// MODERATE QUESTIONS
let moderateQuestions = [
    {
        id: 11,
        question: "Which British King famously had six wives?",
        correctAnswer: "Henry VIII",
        wrongAnswers: ["George VI", "George V", "William IV"]
	},
    {
        id: 12,
        question: "Conquering much of China and central Asia, uniting the wandering tribes and even responsible for creating one of the first international postal systems, who led the Mongols?",
        correctAnswer: "Genghis Khan",
        wrongAnswers: ["Kublai Khan", "The Bogd Khan", "Kaidu"]
	},
    {
        id: 13,
        question: "Which German classical composer and pianist, was the film Immortal Beloved about?",
        correctAnswer: "Ludwig van Beethoven",
        wrongAnswers: ["Mozart", "Johannes Brahms", "Felix Mendelssohn"]
	},
    {
        id: 14,
        question: "In which country would you find Angel Falls, the highest waterfall on earth?",
        correctAnswer: "Venezuela",
        wrongAnswers: ["Mexico", "Canada", "Brazil"]
	},
    {
        id: 15,
        question: "The gaseous elements helium, neon, argon, krypton, xenon, and radon are better known as what?",
        correctAnswer: "noble gases",
        wrongAnswers: ["halogens", "simple gases", "liquified gases"]
	},
    {
        id: 16,
        question: "What is the name of Saturnâ€™s largest moon?",
        correctAnswer: "Titan",
        wrongAnswers: ["Enceladus", "Mimas", "Rhea"]
	},
    {
        id: 17,
        question: "What character has both Robert Downey Jr. and Benedict Cumberbatch played?",
        correctAnswer: "Sherlock Holmes",
        wrongAnswers: ["'Mad' Max Rockatansky", "Charles Spencer Chaplin", "Alan Turing"]
	},
    {
        id: 18,
        question: "What country drinks the most coffee per person?",
        correctAnswer: "Finland",
        wrongAnswers: ["USA", "Canada", "Denmark"]
	},
    {
        id: 19,
        question: "What company was initially known as 'Blue Ribbon Sports'?",
        correctAnswer: "Nike",
        wrongAnswers: ["Addidas", "Puma", "Reebok"]
	},
    {
        id: 20,
        question: "What are the colours of the Olympic Rings?",
        correctAnswer: "red, green, black, blue and yellow",
        wrongAnswers: ["green, yellow, violet, blue, white", "yellow, red, brown, blue, green", "black, orange, yellow, green, red"]
	},
];

// HARD QUESTIONS
let hardQuestions = [
    {
        id: 21,
        question: "Aureolin is a shade of what colour?",
        correctAnswer: "yellow",
        wrongAnswers: ["pink", "orange", "blue"]
	},
    {
        id: 22,
        question: "In what country is the Chernobyl nuclear plant located?",
        correctAnswer: "Ukraine",
        wrongAnswers: ["Austria", "Norway", "Poland"]
	},
    {
        id: 23,
        question: "How many dots appear on a pair of dice?",
        correctAnswer: "42",
        wrongAnswers: ["21", "52", "32"]
	},
    {
        id: 24,
        question: "What country has the only national flag that does not have four sides?",
        correctAnswer: "Nepal",
        wrongAnswers: ["Luxembourg", "Taiwan", "Tuvalu"]
	},
    {
        id: 25,
        question: "What sporting event has a strict dress code of almost entirely white?",
        correctAnswer: "Wimbledon",
        wrongAnswers: ["Tour de France", "Royal Ascot", "US Masters Tournament"]
	},
    {
        id: 26,
        question: "How many minutes are in a full week?",
        correctAnswer: "10,080 minutes",
        wrongAnswers: ["20,160 minutes", "43,800 minutes", "7,200 minutes"]
	},
    {
        id: 27,
        question: "In what capital would you find The Little Mermaid statue?",
        correctAnswer: "Copenhagen",
        wrongAnswers: ["Vienna", "Helsinki", "Athens"]
	},
    {
        id: 28,
        question: "What is Cynophobia the fear of?",
        correctAnswer: "dogs",
        wrongAnswers: ["cats", "computers", "accidents"]
	},
    {
        id: 29,
        question: "Unix Time is defined as the number of seconds that have elapsed since when?",
        correctAnswer: "midnight of January 1, 1970",
        wrongAnswers: ["midnight of January 1, 1987", "noontime of January 1, 1970", "noontime of January 1, 1987"]
	},
    {
        id: 30,
        question: "Who first coined the term 'battery' to describe an electrical storage device?",
        correctAnswer: "Benjamin Franklin",
        wrongAnswers: ["Henry Ford", "Michael Faraday", "Albert Einstein"]
	},
];

// MILLION EURO QUESTIONS
let hardestQuestions = [
    {
        id: 31,
        question: "What is a group of pandas known as?",
        correctAnswer: "an embarassment",
        wrongAnswers: ["a shrewdness", "a murder", "a convocation"]
	},
    {
        id: 32,
        question: "How long is an elephant pregnant before it gives birth?",
        correctAnswer: "22 months",
        wrongAnswers: ["9 months", "12 months", "16 months"]
	},
    {
        id: 33,
        question: "The first successful vaccine was introduced by Edward Jenner in 1796. Which disease did it guard against?",
        correctAnswer: "Smallpox",
        wrongAnswers: ["Yellow Fever", "Poliomyelitis", "Tuberculosis"]
	},
    {
        id: 34,
        question: "Who is the only musician ever to have been awarded the Nobel prize for literature?",
        correctAnswer: "Bob Dylan",
        wrongAnswers: ["Jimi Hendrix", "Elton John", "Stevie Wonder"]
	},
];

// START --> HOME PAGE
if (document.getElementById('homepage-body')) {
    // variables to access the DOM elements
    const howToPlaySection = document.getElementById('howtoplay-outer-wrapper');
    const howToPlayBtn = document.getElementById('howtoplay-btn-homepage');
    const closeHowToPlay = document.getElementById('close-howtoplay');
    const enterNameSection = document.getElementById('username-outer-wrapper');
    const playBtn = document.getElementById('play-button');

    // displays 'Enter Username' lightbox
    playBtn.addEventListener('click', function() {
        enterNameSection.style.display = 'flex';
    })

    // displays 'How to Play' lightbox
    howToPlayBtn.addEventListener('click', function() {
        howToPlaySection.style.display = 'flex';
        howToPlaySection.style.alignItems = 'center';
    });

    // hides 'How to Play' lightbox
    closeHowToPlay.addEventListener('click', function() {
        howToPlaySection.style.display = 'none';
    });
    
    let userNameSubmit = document.getElementById('username-btn');
    userNameSubmit.addEventListener('click', function(e) {
        e.preventDefault();
        if (captureUserName()) {
            self.location.href = 'game-page.html';
        } else {
            let small = document.getElementById('username-needed');
            small.classList.remove('invisible');
        }
    }); 
}
// END --> HOME PAGE

// START --> GAME PAGE
// variables to access the DOM elements
const questionText = document.getElementById('question-text');
const optionButtonsList = document.getElementsByClassName('answer-button');
const questionNumber = document.getElementById('question-number');
const timerValue = document.getElementById('timer-value');
const lifelineRemoveOne = document.querySelector('[data-lifeline="remove-one-option"]');
const lifelineRemoveTwo = document.querySelector('[data-lifeline="remove-two-options"]');
const lifelineAddToTimer = document.querySelector('[data-lifeline="add-to-timer"]');
const optionButtonA = document.getElementById('answer-option-a');
const optionButtonB = document.getElementById('answer-option-b');
const optionButtonC = document.getElementById('answer-option-c');
const optionButtonD = document.getElementById('answer-option-d');

// variables to access the 'money prize' elements in the DOM
const prizeOne = document.querySelector('[data-prize="500"]');
const prizeTwo = document.querySelector('[data-prize="1,000"]');
const prizeThree = document.querySelector('[data-prize="1,500"]');
const prizeFour = document.querySelector('[data-prize="2,000"]');
const prizeFive = document.querySelector('[data-prize="2,500"]');
const prizeSix = document.querySelector('[data-prize="5,000"]');
const prizeSeven = document.querySelector('[data-prize="10,000"]');
const prizeEight = document.querySelector('[data-prize="20,000"]');
const prizeNine = document.querySelector('[data-prize="40,000"]');
const prizeTen = document.querySelector('[data-prize="80,000"]');
const prizeEleven = document.querySelector('[data-prize="100,000"]');
const prizeTwelve = document.querySelector('[data-prize="125,000"]');
const prizeThirteen = document.querySelector('[data-prize="150,000"]');
const prizeFourteen = document.querySelector('[data-prize="200,000"]');
const prizeFifteen = document.querySelector('[data-prize="1-million"]');

// variables to access 'Countdown to Start [Lightbox]'
const countdownSection = document.getElementById('countdown-outer-wrapper');
const countdown = document.getElementById('countdown');

// common variables
let usedQuestions = [];     // variable for list of IDs of used questions
let selectedQuestion;       // variable for randomly selected question
let counter;                // variable for object containing id of timer()

if (document.getElementById('gamepage-body')) {
    // start -> Countdown to Start [Lightbox]
    countdownSection.style.display = 'flex';
    let countdownLeft = 3;
    let countdownId = setInterval(function() {
    if (countdownLeft > 1) {
        countdownLeft--;
        countdown.innerHTML = countdownLeft;
    } else {
        countdown.innerHTML = `GO`;
        clearInterval(countdownId);
        setTimeout(function() {
            countdownSection.style.display = 'none';
        }, 1000);
    }
    }, 1000);
    // end -> Countdown to Start [Lightbox]

    // selects and displays first question
    selectedQuestion = questionRandomizer(easyQuestions);
    displayQuestion();
    counter = timer(30);
    highlightPrize();

    //lifeline to remove one option
    lifelineRemoveOne.addEventListener('click', function() {
        randomChoiceRemove(1);
        // applies 'disabled button' css style once the lifeline buttonis clicked
        this.classList.add("disabled-button");
        // deactives the lifeline button. Code taken from stackoverflow [see README file]
        this.removeEventListener('click', arguments.callee);
    });
    //lifeline to remove two options
    lifelineRemoveTwo.addEventListener('click', function() {
        randomChoiceRemove(2);
        // applies 'disabled button' css style once the lifeline button is clicked
        this.classList.add("disabled-button");
        // deactives the lifeline button. Code taken from stackoverflow [see README file]
        this.removeEventListener('click', arguments.callee);
    });
    // lifeline to add 30 seconds more to the timer
    lifelineAddToTimer.addEventListener('click', function() {
        // stops and adds more time to current timer, and then resumes new timer
        clearInterval(counter.id);
        counter.id = addMoreTime(30);
        // applies 'disabled button' css style once the lifeline button is clicked
        this.classList.add("disabled-button");
        // deactives the lifeline button. Code taken from stackoverflow [see README file]
        this.removeEventListener('click', arguments.callee);
    });

    // Event listener for Option A button
    optionButtonA.addEventListener('click', function() {
        clearInterval(counter.id);
        if (answerChecker(this.innerText.slice(3))) {
            undisableOptionBtns();
            usedQuestions.push(selectedQuestion.id);
            counter = timer(30);
            if (usedQuestions.length < 15) {
                selectedQuestion = setDifficultyLevel();
                displayQuestion();
                highlightPrize();
            } else {
                gameWon();
            }
        } else {
            gameOver();
        }
        console.log('Used Questions:', usedQuestions);
    });

    // Event listener for Option B button
    optionButtonB.addEventListener('click', function() {
        clearInterval(counter.id);
        if (answerChecker(this.innerText.slice(3))) {
            undisableOptionBtns();
            usedQuestions.push(selectedQuestion.id);
            counter = timer(30);
            if (usedQuestions.length < 15) {
                selectedQuestion = setDifficultyLevel();
                displayQuestion();
                highlightPrize();
            } else {
                gameWon();
            }
        } else {
            gameOver();
        }
        console.log('Used Questions:', usedQuestions);
    });

    // Event listener for Option C button
    optionButtonC.addEventListener('click', function() {
        clearInterval(counter.id);
        if (answerChecker(this.innerText.slice(3))) {
            undisableOptionBtns(optionButtonsList);
            usedQuestions.push(selectedQuestion.id);
            counter = timer(30);
            if (usedQuestions.length < 15) {
                selectedQuestion = setDifficultyLevel();
                displayQuestion();
                highlightPrize();
            } else {
                gameWon();
            }
        } else {
            gameOver();
        }
        console.log('Used Questions:', usedQuestions);
    });

    // Event listener for Option D button
    optionButtonD.addEventListener('click', function() {
        clearInterval(counter.id);
        if (answerChecker(this.innerText.slice(3))) {
            undisableOptionBtns();
            usedQuestions.push(selectedQuestion.id);
            counter = timer(30);
            if (usedQuestions.length < 15) {
                selectedQuestion = setDifficultyLevel();
                displayQuestion();
                highlightPrize();
            } else {
                gameWon();
            }
        } else {
            gameOver();
        }
        console.log('Used Questions:', usedQuestions);
    });
}
// END -- > GAME PAGE

function captureUserName() {
    const userName = document.getElementById('username').value;
    if (userName) {
        let key = sessionStorage.length;
        sessionStorage.setItem(key, userName);
        return userName;
    } else {
        return false;
    }
}

/**
 * Randomly selects question based on specified difficulty level
 * @param {string} qCategory - The level of difficulty of the question
 * @returns A randomized question
 */
function questionRandomizer(qCategory) {
    let randomNumber = Math.floor(Math.random() * qCategory.length);
    return qCategory[randomNumber];
}

/**
 * Displays the question and answer options in the game page
 */
function displayQuestion() {
    questionText.innerText = selectedQuestion.question;
    questionNumber.innerText++;
    let shuffledOptions = shuffleOptions();
    let letterSequence = ['A.', 'B.', 'C.', 'D.'];
    for (let i = 0; i < optionButtonsList.length; i++) {
        optionButtonsList[i].innerText = `${letterSequence[i]} ${shuffledOptions[i]}`;
        // un-disable disabled buttons
        optionButtonsList[i].classList.remove('disabled-button');
    }
}

/**
 * Returns a shuffled list of answer options from the selected question 
 * @returns shuffled list of answer options
 */
function shuffleOptions() {
    let optionsList = [selectedQuestion.correctAnswer, selectedQuestion.wrongAnswers[0], selectedQuestion.wrongAnswers[1], selectedQuestion.wrongAnswers[2]];
    for (let i = 0; i < 4; i++) {
        let randIndex = Math.floor(Math.random() * optionsList.length);
        let lastItem = optionsList.pop();
        optionsList.splice(randIndex, 0, lastItem);
    }
    return optionsList;
}

/**
 * Checks the user's answer and returns true or false
 * @param {string} answerText - Text content of the answer
 * @returns true or false
 */
function answerChecker(answerText) {
    if (selectedQuestion.correctAnswer === answerText) {
        console.log("Correct!", selectedQuestion.correctAnswer, "=", answerText);
        return true;
    } else {
        console.log(`Wrong! 
        Correct Answer: ${selectedQuestion.correctAnswer}, 
        "Your answer:", ${answerText}`);
        return false;
    }
}

/**
 * Displays a timer that counts from specified max time down to 0
 * @param {number} num - Initial time for timer to start from
 * @returns An object with setInterval() id
 */
function timer(num) {
    let timeLeft = parseInt(num);
    let timeInterval = setInterval(function(){
        if (timeLeft >= 0) {
            timeLeft--;
            timerValue.innerText = timeLeft + 1;
        } else {
            gameOver();
            clearInterval(timeInterval);
        }
    }, 1000);
    return {id: timeInterval};
}

/**
 * Adds specified time to the identified counter
 * @param {number} numToAdd - time (in seconds) to add to the current counter
 * @returns timer id
 */
function addMoreTime(numToAdd) {
    let num = parseInt(timerValue.innerText) + numToAdd;
    return timer(num).id;
}

/**
 * Displays a Game Over lightbox with 'play again' button
 * and 'Home' button
 */
function gameOver() {
    let gameOverPopUp = document.getElementById('gameover-outer-wrapper');
    let playAgainLoser = document.getElementById('play-again-gameover');

    gameOverPopUp.style.display = 'flex';
    playAgainLoser.addEventListener('click', function() {
        location.reload();
    })
}

/**
 * Randomly removes wrong option/s for the answer to the question
 * @param {number} num - Number of wrong options to remove
 */
function randomChoiceRemove(num) {
    let randNum = Math.floor(Math.random() * 3);
    let optionsRemoved = [];
    for (let i = 0; i < num; i++) {
        randNum = Math.floor(Math.random() * 3);
        let selectedAnswer = selectedQuestion.wrongAnswers[randNum];
        while (optionsRemoved.includes(selectedAnswer)) {
            randNum = Math.floor(Math.random() * 3);
            selectedAnswer = selectedQuestion.wrongAnswers[randNum];
        }
        optionsRemoved.push(selectedQuestion.wrongAnswers[randNum]);
    }
    // disable answer buttons when removed by lifeline click
    for (let optionBtn of optionButtonsList) {
        for (let i = 0; i < optionsRemoved.length; i++) {
            if (optionBtn.innerText.slice(3) === optionsRemoved[i]) {
                optionBtn.disabled = true;
                optionBtn.classList.add('disabled-button');
            }
        }
    }
}

/**
 * Un-disable answer buttons that were disabled
 */
function undisableOptionBtns() {
    for (let optionBtn of optionButtonsList) {
        optionBtn.disabled = false;
    }
}

/**
 * Sets the difficulty of question
 * @returns randomly selected question
 */
function setDifficultyLevel() {
    if (usedQuestions.length <= 4){
        selectedQuestion = questionRandomizer(easyQuestions);
        while (usedQuestions.includes(selectedQuestion.id)) {
            selectedQuestion = questionRandomizer(easyQuestions);
        }
        return selectedQuestion;
    } else if (usedQuestions.length > 4 && usedQuestions.length < 10) {
        selectedQuestion = questionRandomizer(moderateQuestions);
        while (usedQuestions.includes(selectedQuestion.id)) {
            selectedQuestion = questionRandomizer(moderateQuestions);
        }
        return selectedQuestion;
    } else if (usedQuestions.length >= 10 && usedQuestions.length < 14) {
        selectedQuestion = questionRandomizer(hardQuestions);
        while (usedQuestions.includes(selectedQuestion.id)) {
            selectedQuestion = questionRandomizer(hardQuestions);
        }
        return selectedQuestion;
    } else {
        selectedQuestion = questionRandomizer(hardestQuestions);
        return selectedQuestion;
    }
}

/**
 * Returns the current and previous prize money depending on
 * the question number
 * @param {string} qNum - question number as string
 * @returns An object containing current prize and previous prize
 */
function PrizeMoney(qNum) {
    switch (qNum) {
        case "1": 
            return {current: prizeOne};
        case "2":
            return {current: prizeTwo, previous: prizeOne};
        case "3":
            return {current: prizeThree, previous: prizeTwo};
        case "4":
            return {current: prizeFour, previous: prizeThree};
        case "5":
            return {current: prizeFive, previous: prizeFour};
        case "6":
            return {current: prizeSix, previous: prizeFive};
        case "7":
            return {current: prizeSeven, previous: prizeSix};
        case "8":
            return {current: prizeEight, previous: prizeSeven};
        case "9":
            return {current: prizeNine, previous: prizeEight};
        case "10":
            return {current: prizeTen, previous: prizeNine};
        case "11":
            return {current: prizeEleven, previous: prizeTen};
        case "12":
            return {current: prizeTwelve, previous: prizeEleven};
        case "13":
            return {current: prizeThirteen, previous: prizeTwelve};
        case "14":
            return {current: prizeFourteen, previous: prizeThirteen};
        case "15":
            return {current: prizeFifteen, previous: prizeFourteen};
    }
}
/**
 * Provides styling to current and previous prize money
 */
function highlightPrize() {
    let currentPrize = PrizeMoney(questionNumber.innerText).current;
    let previousPrize = PrizeMoney(questionNumber.innerText).previous;
    currentPrize.classList.add('current-prize');
    currentPrize.scrollIntoView({behavior: "smooth", block: "center"});
    if (previousPrize) {
        previousPrize.style.opacity = 0.5;
    }
}

/**
 * Displays the 'Game Won' lightbox with 'Play Again' and 'Home' buttons 
 */
function gameWon() {
    const gameWonSection = document.getElementById('gamewon-outer-wrapper');
    gameWonSection.style.display = 'flex';
    clearInterval(counter.id);

    const playAgainWinner = document.getElementById('play-again-gamewon');
    playAgainWinner.addEventListener('click', function() {
        location.reload();
    })
}